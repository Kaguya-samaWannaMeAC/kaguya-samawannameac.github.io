---
hide:
  - toc
---

# 2022-01-07~

## **CF1620F**

### 题意

给定一个排列 $a_1,a_2,\ldots,a_n$，构造一个方案，将一些位置上的数变为相反数，设新得到的序列为 $b_1,b_2,\ldots,b_n$，满足下面的图为二分图：

- 边 $(i,j)$ 存在当且仅当 $i<j$ 且 $b_i > b_j$。

($1 \le n \le 10^6$)

### 题解

结论：这样的图是二分图 $\Leftrightarrow$ 不存在长度为 $3$ 的下降子序列。

> $\Rightarrow$：若存在子序列 $b_i,b_j,b_k$ ($i<j<k$) 递减，则这是一个三元环，该图不是二分图。
>
> $\Leftarrow$：只需证不存在大于 $3$ 的奇环，若有这样的环，和环上一个点 $i$ 相连的两个点 $j,k$ 必然在 $i$ 的一侧，即要么都大于 $i$ 要么都小于 $i$，否则会产生长度为 $3$ 的下降子序列。考虑对所有边计数，在所有 $i>j$ 且 $i>k$ 的 $i$ 处给这两条边 $(i,j)$ 和 $(i,k)$ 计数，这样所有边都被恰好算了一次，且总数量是偶数，与奇环矛盾。

一个暴力 dp，设 $f_{i,j,k}$ 为前 $i$ 个数，长度为 $1,2$ 的下降子序列最后一个数的最大值分别为 $j,k$ 是否可行，复杂度是 $O\left(n^3\right)$。

利用 dp 的值，而不是只存储布尔值，设 $f_{i,j}$ 为前 $i$ 个数，长度为 $1$ 的下降子序列最后一个数的最大值为 $j$，长度为 $2$ 的下降子序列最后一个数的最大值最小能是多少，复杂度是 $O\left(n^2\right)$。

继续通过转移的性质优化：
$$
\begin{aligned}
&a_i \to f_{i,j}, &&\text{if } f_{i-1,j}<a_i<j \\
&f_{i-1,j} \to f_{i,a_i}, &&\text{if } a_i>j \\
&-a_i \to f_{i,j}, &&\text{if } f_{i-1,j}<-a_i<j \\
&f_{i-1,j} \to f_{i,-a_i}, &&\text{if } -a_i>j \\
\end{aligned}
$$
可以看到 $j$ 和 $f_{i,j}$ 至少有一个是 $\pm a_i$，那么可以将状态简化为 $g_{i,0/1,0/1}$ 表示 $j/f_{i,j}=a_i/-a_i$ 时另一个值 ($f_{i,j}/j$) 的最小值，转移同上，时间复杂度为 $O(n)$。输出方案在转移时记录一下即可，$g$ 中已经记录了当前 $a_i$ 的正负，只需从哪一个状态转移过来的即可。

## **CF1622F**

### 题意

求 $\{1,2,\ldots,n\}$ 的最大子集 $S$ 使得 $\displaystyle \prod _{x \in S} x!$ 是完全平方数。($1 \le n \le 10^6$)

### 题解

需要先观察/打表出最多从 $S$ 中删掉 $3$ 个数：

- 如果 $n$ 是偶数，注意到 $(2i-1)!$ 和 $(2i)!$ 乘起来除了 $2i$ 都被抵消了 (即不影响是否是完全平方数)，因此只需保证 $\displaystyle \prod _{i=1}^{\frac{n}{2}}2i$ 是完全平方数，即 $\displaystyle 2^{\frac{n}{2}}\left(\frac{n}{2}\right)!$ 是完全平方数，若 $\dfrac{n}{2}$ 是偶数，从 $S$ 中删掉 $\dfrac{n}{2}$ 即可；否则从 $S$ 中删掉 $\dfrac{n}{2}$ 和 $2$ 即可。
- 如果 $n$ 是奇数，把 $n$ 删掉就可以转化到上面的情况，最多从 $S$ 中删掉 $3$ 个数。

接下来只需要判断能否删 $< 3$ 个数。将  $\displaystyle \prod _{x \in S} x!$ 表示为一个 $01$ 串，代表每个质因子是否为奇数次幂，若 $n$ 是偶数只需算 $\displaystyle \prod _{i=1}^{\frac{n}{2}}2i$，否则先算 $(n-1)!$ 再单独算 $n!$ 的贡献。

若全为 $0$ 则已经是完全平方数，答案为 $0$；否则将 $01$ 串哈希设为 $h$，接着从小到大遍历 $i!$ 计算其对应的 $01$ 串，若有一个哈希值和 $h$ 相同，则答案为 $1$；否则将每个 $i!$ 对应 $01$ 串的哈希值放入 `map`，通过 $h$ 算出另一个 $01$ 串及其哈希值，在 `map` 里寻找即可。

若都没有，则答案一定为 $3$，且为上面所述的情况。时间复杂度为 $O(n\log n)$。

## **ABC234H**

### 题意

二维平面上 $n$ 个点，输出所有欧氏距离不超过 $k$ 的点对，保证数量不超过 $4 \times 10^5$。($1 \le n \le 2 \times 10^5$)

### 题解

赛时做法是 KD-Tree 暴力找每个圆内所有点，可以卡过去。

设点对数量为 $m$，题解给出的 $O(n+m)$ 的做法如下：

> $k \times k$ 画格子，那么合法点对一定在同一格子或在相邻格子。暴力枚举所有可能，复杂度是对的。
>
> 对于前者，假设一个格子内有 $n$ 个点，计算量为 $n^2$，可以证明格子内合法点对的数量的下界是 $\Omega\left(n^2\right)$ 的，考虑用四个 $\dfrac{k}{\sqrt 2} \times \dfrac{k}{\sqrt 2}$ 的小正方形完全覆盖 $k \times k$ 的格子 (中间有重合的地方)，那么一定存在 $\left\lceil\dfrac{n}{4}\right\rceil$ 个点在同一个小正方形内，它们两两之间的距离均不超过 $k$，从而数量是 $\Omega\left(n^2\right)$ 的，也就是说这 $n^2$ 的计算量至少会找到 $\Omega\left(n^2\right)$ 对点对。
>
> 对于后者，设两个格子分别各有 $n,m$ 个点，计算量为 $nm$，而 $nm \le \dfrac{1}{2}\left(n^2+m^2\right)$，且一个格子至多和四个格子相邻，因此相当于每个格子计算量的 $n^2$ 乘以了一个常数倍，不影响复杂度。
