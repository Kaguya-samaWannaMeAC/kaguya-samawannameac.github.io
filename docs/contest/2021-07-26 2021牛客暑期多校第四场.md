# [2021牛客暑期多校第四场](https://ac.nowcoder.com/acm/contest/11255)

| 排名    | 当场过题数 | 至今过题数 | 总题数 |
| ------- | ---------- | ---------- | ------ |
| 26/1292 | 8          | 10         | 10     |

## **A**

**upsolved by JJLeo 2sozx**

### 题意

每门课有个学分 $0\sim5$ ，可以无限选择，所有课程形成一棵树，每个点有个限制 $c_i$ 表示子树内包括自己至少选择 $c_i$ 学分的课，$q$ 次询问，每次问总学分 $w_i$ 有多少种选择课程的方案。$n\le100, c_i\le 150, q\le 10, w_i\le10^8$

### 题解

#### Sol.1

显然如果不考虑 $c_i$ 的限制，每个点的方案就是一个生成函数，记录为 $\dfrac{f_i}{g_i}$ 。

考虑 $c_i$ 这个限制，对于 $g_i$ 求逆与 $f_i$ 乘起来，删掉前 $c_i - 1$ 项的系数即可，考虑去维护这个 $\dfrac{f_i}{g_i}$ ，考虑通分，然后用 $f_i$ 减即可，多项式项数维护到 $n\times \max(c)$ 即可，大点也能过。

考虑对于根的多项式，可以通过 $BM$ 来计算 $w$ 大的值，对于 $w$ 很小的值需要直接用多项式来算，因为前面的数并不是一个完全的多项式，而是删来删去得到的多项式，复杂度 $O($能过$)$

## **B**

**solved by JJLeo 2sozx**

### 题意

$1\sim n$ ，各有概率 $p_i$，每次随机选择一个数，如果这次选的数比之前最大的数小，结束，否则继续选。每次游戏的分数为进行轮数 $x$ 的平方，求总的期望得分。$n \le 100$ 

### 题解

考虑将平方变为每一次增加一个等差数列的贡献，即$1 + \cdots + 2i - 1 = i ^ 2$，这样如果在这个序列前面加一个数，总贡献变为

$$1 + 2 * (1 + \cdots + 2i - 1) + (1 + \cdots + 2i - 1)$$

这样我们只需要维护总贡献 $f_i$，以及单位贡献 $g_i$ 即可转移。  

$g_i = \sum\limits_{j=1}^{i - 1}p[j] + \sum\limits_{j = i}^{n}p_ig_i, f_i = 3\sum\limits_{j = 1}^{i - 1}p[j] + 2\sum\limits_{j = i}^{n}p_ig_i + \sum\limits_{j = i}^{n}p_if_i$

复杂度为 $O(n)$。

<del>不知道为啥n这么小</del>

## **D**

**upsolved by JJLeo**

### 题意



### 题解



## **G**

**solved by JJLeo 2sozx**

### 题意

求$\sum_{[\sum\limits_{i = 1}^{n}a_i = D]}\dfrac{D!}{\prod\limits_{i = 1}^{n}(a_i + k)!}$，$n \le 50, k \le 50, D\le 10^8, a_i\ge 0$

### 题解

假设 $k = 0$ ，式子等价于 $a_i$ 表示数字 $i$ 选择了几次，一共有 $D$ 个位置的所有排列，这个又等价于长度为 $D$ 的数组，每个位置可以选择 $n$ 个数，答案即为 $n^{D}$

考虑转化式子，将其变为


$$
\sum_{[\sum\limits_{i = 1}^{n}a_i = D + nk]}\dfrac{(D + nk)!}{\prod\limits_{i = 1}^{n}(a_i)!}\dfrac{D!}{(D + nk)!}
$$
此时 $a_i \ge k$ ，因此考虑容斥，我们只需要考虑有 $i$ 个数小于 $k$，和为 $j$ 的个数有多少个，贡献即可 $O(1)$ 计算。个数可以直接用背包计算。

## **H**

**solved by JJLeo 2sozx**

### 题意

$$
x \otimes y=\prod _i p_i^{|a_i-b_i|}
$$

$$
b_i=\sum_{1 \le j,k \le n,j \otimes k = i} a_jk^c
$$

​	给定 $a$ ，求所有的 $b$，在 $\mod 998244353$ 意义下。$n\le10^6$

### 题解

$$
x \otimes y=\prod _i p_i^{|a_i-b_i|}= \frac{xy}{\gcd^2(x,y)}
$$

$$
\begin{aligned}
b_i&=\sum_{1 \le j,k \le n,j \otimes k = i} a_jk^c \newline
&=\sum_{\frac{jk}{\gcd^2(j,k)}=i} a_jk^c \newline
&=\sum_{\frac{jk}{d^2}=i,d=\gcd(j,k)} a_jk^c \newline
&=\sum_{d=1}^n\sum_{j=1}^{\left\lfloor\frac{n}{d}\right\rfloor}\sum_{k=1}^{\left\lfloor\frac{n}{d}\right\rfloor}[jk=i,\gcd(j,k)=1]a_{jd}{(kd)}^c \newline
&=\sum_{d=1}^nd^c\sum_{j=1}^{\left\lfloor\frac{n}{d}\right\rfloor}\sum_{k=1}^{\left\lfloor\frac{n}{d}\right\rfloor}[jk=i,\gcd(j,k)=1]a_{jd}k^c
\end{aligned}
$$



设：


$$
f(j,k)=\sum_{i=1}^{k}a_{ij}i^c
$$


原式化为：


$$
b_i=\sum_{j=1}^n \sum_{k=1}^n [jk=i,\gcd(j,k)=1]k^cf\left(j,\min\left(\left\lfloor\frac{n}{j}\right\rfloor,\left\lfloor\frac{n}{k}\right\rfloor\right)\right)
$$



## **记录**

0h：看F过的人贼多CSK、ZYF想F，MJX乱看，然后ZYF挂了一发，发现X，i写反了，改了就过了，之后MJX把J写了，CSK给MJX讲了个C的做法，太对了就去写了，MJX喂了ZYF一个I的正解，MJX脑子一抽把正解改假了又给了ZYF，寄了一发，C第一发也寄了

1h：MJX重写了个I，过了，CSK改了改C也过了，ZYF看E是个经典算法，又TMD被卡常了，改了改就过了，MJX旁边搁哪推B式子，没用期望推属实是个小可爱。

2h：ZYF E写完了推了推B就推出来了，MJX直接爬去看G，改吧改吧式子喂给了ZYF，ZYF直接冲锋，然后发现逆元写成了阶乘的逆元，改了就过了。

3h：ZYF看D就是个原题，想了个想法，看看能不能把这个式子的意义算出来，MJX想了个意义，大概差不多，有点歪，然后被ZYF日掉了，之后就感觉不可做了

4h：开始看我们开始觉得一点都不可做的H题，4.10的时候MJX突然想到了一个式子的转化，然后这道题就变sb了，就过了，最后终于过稳定过过题了，不容易

## **总结**

## **Dirt**

F(+1)：ZYF X战警<br>I(+1)：MJX要想的深一点，优化很有可能是错的<br>C(+1)：<br>E(+1)：卡常，stl慎用<br>G(+1)：逆元写错了

